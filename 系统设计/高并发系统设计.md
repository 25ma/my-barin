
# 1. 系统设计原则

## 1.1. 系统通用设计方法

我们在应对高并发大流量时会采用类似“抵御洪水”的方案，归纳起来共有三种方法：

- Scale-up（纵向扩展）与 Scale-out（横向扩展）

	纵向扩展旨在增加机器配置达到应对请求流量的目的，然而随着硬件发展，摩尔定律已经失效，所以纵向扩展前期能收获一定成果，但有一定上限。

	横向扩展，分而治之是一种常见的高并发系统设计方法，采用分布式部署的方式把流量分流开，让每个服务器都承担一部分并发和流量。

	Scale-out 虽然能够突破单机的限制，但也会引入一些复杂问题。比如，如果某个节点出现故障如何保证整体可用性？当多个节点有状态需要同步时如何保证状态信息在不同节点的一致性？如何做到使用方无感知的增加和删除节点？其中每一个问题都涉及很多方面，因此需要仔细考虑。

- 缓存

	使用缓存来提高系统的性能，就好比用“蓄水池”的方式抵抗高并发大流量的冲击。

- 异步

	在某些场景下，未处理完成之前我们可以让请求先返回，在数据准备好之后再通知请求方，这样可以在单位时间内处理更多的请求。

## 1.2. 系统的分层架构

分层的好处：

- 分层的设计可以简化系统设计，让不同的人专注做某一层次的事情。

- 分层之后可以做到很高的复用。

- 分层架构可以让我们更容易做横向扩展。

任何的方案架构都是有优势有缺陷的，它最主要的一个缺陷就是增加了代码的复杂度，也可能会有性能的损耗，但是相比于它能带给我们的好处来说，这些都是可以接受的，或者可以通过其它的方案解决的。我们在做决策的时候切不可以偏概全，因噎废食。

## 高并发系统设计思路

1. 高性能

	- 性能的度量指标：平均值、最大值、最小值、分位值等。

	- 性能的优化方式

		- 提升处理核心数，如进程数量，但需要注意测试进程数量与性能的关系，找到拐点。

		- 提升单次任务响应时间。

2. 高可用

	高可用要求提升系统的可用性，也就是我们常说的几个 9。

	系统设计方面：可以从故障恢复、超时控制、降级、限流几方面进行。

	系统运维方面：可以从灰度发布，故障演练两方面进行。

3. 高扩展

	- 存储层的扩展：数据库拆分

	- 业务层的扩展：按业务维度、重要维度、请求来源等进行拆分。