#消息队列 

# 消息队列大纲

- 消息队列如何做到高可用？
	- Rabbit 的单机模式、普通集群模式 (多机器消费一台机器的 queue)、镜像模式 (每台机器同步 queue)
	- Kafka 的模式：一个节点是一个 broker，一个 topic 划分成多个 partion 同步到不同的 broker 上，形成 replica 副本。Replica 选举 leader，读写都与 leader 进行。当消息成功写到所有 replica 副本，消息才可被读到。
- 消息队列的可靠传输，如何保证消息不丢失
	- RabbitMQ
		- 生产者方面
			- 开始事务处理
			- 开启 confirm 模式
		- MQ 服务器方面：开启持久化
		- 消费者方面：关闭自动 ACK 确认，手动消费确认
- 消息的有序性如何保证？
- 消息堆压如何解决？
	- 临时提高消费者数量，将消息转移到其他队列中慢慢消费优先恢复原消费者速度。
	- 消息丢弃采取补偿手段补偿数据。
- 如何设计一个 MQ 系统？
	- 伸缩性方面：可快速扩容，如 Kafka 的 broker -> topic -> partition 的模式
	- 持久化方面：数据需要写入磁盘；生产者与消费者的消息确认机制。
	- 可用性方面：部分节点宕机可快速切换与恢复
