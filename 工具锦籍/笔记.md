# Spring

- 手动回滚当前事务

  ```java
  TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
  ```
  
- 回滚事务到指定回滚点

  ```
  // 设置回滚点，
  Object savePoint = TransactionAspectSupport.currentTransactionStatus().createSavepoint();  
  
  // 回滚到savePoint事务点
  TransactionAspectSupport.currentTransactionStatus().rollbackToSavepoint(savePoint);
  ```

- 动态设置Rabbit Listener的监听队列

  利用SPEL表达式进行数据的注入

  ~~~java
  /**
   * RabbitMq配置信息
   * @author varg
   * @date 2020/8/9 14:46
   */
  @Component
  public class RabbitMqConfig {
  
      /**
       * 排版交换机
       */
      @Value("${queue:queue}")
      public String queue;
  
  }
  
  @Resource
  RabbitMqConfig rabbitMqConfig;
  
  @RabbitListener(queues = "#{rabbitMqConfig.queue}")
  ~~~

- 反射获取方法/类上的注解
	使用method.isAnnotationPresent()方法无法获取到被代理方法上到注解，使用Spring的工具类AnnotationUtils.findAnnotation()实现此需求。

- Redis 和 Mysql 操作在同一个事务中，出现异常如何同时回滚这两个数据库的操作

  - Redis 的操作是否受 Spring 事务管理的控制？

# Git

- 暂存改动不提交

  git stash save

  git stash pop

- 多版本切换

  - 切换到某一个版本

    git reset --hard [version number]

  - 从当前版本切换回最新版本

    首先需要查看到最新版本的版本号

    git reflog 该命令可以查看执行过的git命令并记录相关版本号
	
	- 将文件从暂存区移动到工作区
	~~~shell
	git rm -f --cache /path/file
	~~~

    利用上一条命令切换到最新版本

# Lamba

| 类型         | 语法               | 对应的Lambda表达式                   |
| ------------ | ------------------ | ------------------------------------ |
| 静态方法引用 | 类名::staticMethod | (args) -> 类名.staticMethod(args)    |
| 实例方法引用 | inst::instMethod   | (args) -> inst.instMethod(args)      |
| 对象方法引用 | 类名::instMethod   | (inst,args) -> 类名.instMethod(args) |
| 构建方法引用 | 类名::new          | (args) -> new 类名(args)             |



# Mysql

- 数据库查询字段日期类型不传与传0两种方式数据查询时间相差很大

  

# 算法

![](https://varg-my-images.oss-cn-beijing.aliyuncs.com/img/20201110174742.png)



# Tool

- fastjson

  - 数组string转list

    ~~~java
    	List<DTO> result = JSON.parseObject("jsonstring", new TypeReference<List<DTO>>() {});
    ~~~

    

# Windows常用命令

##### 查看端口占用情况

~~~bash
netstat -ano |findstr ["端口号"]
~~~

##### 通过进程 ID 查询进程信息

~~~bash
tasklist |findstr ["进程id号"]
~~~

##### 杀死进程

~~~bash
taskkill /f /t /im ["进程id或者进程名称"]
~~~

# LInux常用命令

##### 软件授权

~~~bash
sudo xattr -rd com.apple.quarantine [软件的路径]
~~~

##### 启动/停止应用
~~~bash
# 停止应用: 
launchctl unload /Library/LaunchAgents/com.paloaltonetworks.gp.pangp*

# 停止应用且关闭自启动:
launchctl unload -w /Library/LaunchAgents/com.paloaltonetworks.gp.pangp*

# 启动应用: 
launchctl load /Library/LaunchAgents/com.paloaltonetworks.gp.pangp*

# 启动应用且开启自启动: 
launchctl load -w /Library/LaunchAgents/com.paloaltonetworks.gp.pangp*
~~~

#### which
which命令可以定位到应用到执行路径
~~~bash
# 输出java的执行路径
which java
~~~

#### ls
##### 查找当前文件链接的源地址信息
~~~bash
ls -lrt [path]
~~~

#### 后台启动应用
~~~bash
# 'nohup' 参数使用后ssh连接关机后也不会停止程序，'&'命令表示后台启动
nohup java -jar xxx.jar > info.log &
~~~

#### 查看磁盘占用情况
~~~bash
sudo find /data -type f -size +500M |xargs ls -lh
~~~

#### 安装brew
```shell
# 来源: https://zhuanlan.zhihu.com/p/111014448
/bin/zsh -c "$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)"
```

#### brew替换软连接
```shell
brew link git --overwrite
```

#### 链接服务器下载文件

~~~bash
scp Ihadmin@10.231.144.153:/data/apps/nd-bim-controller/logs/java.hprof /users/admin/Downloads
~~~

#### 快捷命令

```bash
# 为pr_code指定别名
alias pr_code='cd/home/tt/project/branches/release/code/server/'
```

定义的别名只针对当前SSH连接有效,如果需要针对当前用户有效，需要把`alias pr_code='cd /home/tt/project/branches/release/code/server/'` 加入到 `~/.bashrc`配置中，如果需要针对所有用户有效，需要把 `alias pr_code='cd /home/tt/project/branches/release/code/server/'`加入到`/etc/bashrc` 配置中